<!-- 
PROBLEM SET TWO, PARTS 4
Y. KIT WU 

This is part four. Upon clicking a country, the circles and texts of other countries that are in its top 10 trade list will enlarge. 

There's not too much functionality, as you can probably tell; the transitions and typography, however, has been crafted to be as smooth as possible. Without the burden of links, as was the case in graph.html, the visualization moves a lot smoothly and the selected countries enlarge/minimize instantaneously. 

In the "small circles" layout, it's really easy to see how most countries have top trading partners within their own continents. What's also interesting is that in the "life expectancy" portion, a lot of the countries at the top of the life expectancy ranking trade with other nations that also have high life expectancy. A correlation between improvements in life expectancy and international economic activity, perhaps? 

Besides this, this is also a case where you can go around clicking from enlarged node to enlarged node. It's quite fun, at least for a while. 
--> 

<!DOCTYPE html>
<html>
<head>
<script src="http://d3js.org/d3.v3.min.js"></script>
<link href='http://fonts.googleapis.com/css?family=Lato:300' rel='stylesheet' type='text/css'>
  <style type="text/css">
    body {
      width: 800px;
      margin: 25px auto;
      font-family: 'Lato', sans-serif;
      text-align: center;
    }
    circle {
      fill: steelblue;
      fill-opacity: 0.8;
    }
    .node:hover {
      opacity:0.5;
    }
  }
  </style>
</head>
<body>
  <h1>Part Four: Exploring Trade Partners, 2012</h1>
  <p>
    In this minimalist visualization, you can click on countries to see which other countries are the top 10 trade partners with that individual nation. No complex functionalities, just a clean layout with multiple arrangement of nations. I personally recommend doing this with the small circles arrangement.
  <p>
    <form>
    Layout:
      <label><input type="radio" name="layout" value="default" checked> Default </label>
      <label><input type="radio" name="layout" value="population"> Population </label>
      <label><input type="radio" name="layout" value="gdp"> GDP </label>
      <label><input type="radio" name="layout" value="life_expectancy"> Life Expectancy </label> 
      <label><input type="radio" name="layout" value="populationGDP"> Show by Population and GDP </label>
      <label><input type="radio" name="layout" value="GDPpouplation"> Show by GDP and Population </label>
      <label><input type="radio" name="layout" value="life_expectancyGDP"> Life Expectancy and GDP </label> 
      <label><input type="radio" name="layout" value="latlong"> Latitude and Longitude </label> 
      <label><input type="radio" name="layout" value="singlePoint"> Single Point </label> 
      <label><input type="radio" name="layout" value="circularLayout"> Circular Layout </label>
      <label><input type="radio" name="layout" value="miniCircles">  Small Circles </label>
    </form>

  <script type="text/javascript">

  var margin = {top: 40, bottom: 10, left: 20, right: 20};
  var width = 800 - margin.left - margin.right;
  var height = 1500 - margin.top - margin.bottom;

  // Creates sources <svg> element and inner g (for margins)
  var svg = d3.select("body").append("svg")
              .attr("width", width+margin.left+margin.right)
              .attr("height", height+margin.top+margin.bottom)
            .append("g")
              .attr("transform", "translate("+margin.left+","+margin.top+")");

  /////////////////////////

  var circles;

  var texts;

  // creating an array of topCountries so that I can check which circle + text elements to enlarge upon a click
  var topCountries = [];

  var color = d3.scale.category20();

  d3.json("data/countries_1995_2012.json", function(data) {

    // Nodes data join
    var node = svg.selectAll(".node")
        .data(data)
        .enter()
        .append("g").attr("class", "node")
        .on("click", function changeCircle(d) {
          // this all happens upon the clicking of a node

          // this was supposed to enlarge the specific node clicked by the user, but I think it clashed with some of the functionalities implemented below so I removed that. Now, only the top 10 exports of a country clicked changes in size. 
          d3.select(this).select("text").transition()
            .duration(1000)
            .style("font-size", "20px");
          d3.select(this).select("circle").transition()
            .duration(1000)
            .attr("r", 50);

          topCountries = d.years[17].top_partners.map(function(e){
            return e.country_id;
          });
          
          // changing the size of circles in top 10 countries
          d3.selectAll("circle").transition().duration(1500).attr("r", function(e){
              if (topCountries.indexOf(e.country_id) != -1) {
                return 30;
              }
              else {
                return 5;
              }
            })

          // changing the size of text in the top 10 countries
          d3.selectAll("text").transition().duration(1500).attr("font-size", function(e){
              if (topCountries.indexOf(e.country_id) != -1) {
                return 20;
              }
              else {
                return 10;
              }
            })
        });
        // end of onclick function

    // for circle and text creation
    circles = node
      .append("circle")
      .transition().duration(1500)
      .style("fill", function(d) {return color(d.continent); })
      .attr("r", function(e){
        if (topCountries.indexOf(e.country_id) != -1) {
          return 30;
        }
        else {
          return 5;
        }
      })
      .attr("cx", function(d) {
          return width/2;
      })
      .attr("cy", function(d,i) {
          return i*10;
      });

      texts = node
        .append("text")
        .attr("font-size", function(e){
                if (topCountries.indexOf(e.country_id) != -1) {
                  return 20;
                }
                else {
                  return 10;
                }
              })
        .attr("x", function(d) {
            return width/2 + 10;
        })
        .attr("y", function(d,i) {
            return i*10;
        })
        .text(function(d) { return d.name })

    // Functions that move the nodes and the text start here
    function showByDefault() {
        svg.selectAll("circle")
        .transition().duration(1500)
        .attr("cy", function(d,i){
          return i*10;
        })
        .attr("cx", function(d) {
          return width/2;
        })

        svg.selectAll("text")
        .transition().duration(1500)
        .attr("y", function(d,i){
          return i*10;
        })
        .attr("x", function(d) {
          return width/2 + 10;
        })
      }

    function showByPopulation() {
        console.log("hey look it works!");
        svg.selectAll("circle")
        .transition().duration(1500)
        .attr("cy", function(d,i){
          return d.years[17].population/100000;
        })
        .attr("cx", function(d) {
          return width/2;
        })

        svg.selectAll("text")
        .transition().duration(1500)
        .attr("y", function(d,i){
          return d.years[17].population/100000;
        })
        .attr("x", function(d) {
          return width/2 + 10;
        })
      }

    function showByGDP() {
        svg.selectAll("circle")
        .transition().duration(1500)
        .attr("cy", function(d,i){
          return d.years[17].gdp/100000000;
        })
        .attr("cx", function(d) {
          return width/2;
        })

        svg.selectAll("text")
        .transition().duration(1500)
        .attr("y", function(d,i){
          return d.years[17].gdp/100000000;
        })
        .attr("x", function(d) {
          return width/2 + 10;
        })
      }

    function showByLifeExpectancy() {
      svg.selectAll("circle")
      .transition().duration(1500)
      .attr("cy", function(d,i){
        return d.years[17].life_expectancy*10 - 500;
      })
      .attr("cx", function(d) {
          return width/2;
        })

      svg.selectAll("text")
      .transition().duration(1500)
      .attr("y", function(d,i){
        return d.years[17].life_expectancy*10 - 500;
      })
      .attr("x", function(d) {
          return width/2 + 10;
      })
      }

    // Functions that changes both the x and y positions of countries

    function showByPopulationAndGDP() {
        svg.selectAll("circle")
        .transition().duration(1500)
        .attr("cx", function(d) {
          return d.years[17].gdp/100000000;
        })
        .attr("cy", function(d,i){
          return d.years[17].population/100000;
        })

        svg.selectAll("text")
        .transition().duration(1500)
        .attr("x", function(d) {
          return d.years[17].gdp/100000000 + 10;
        })
        .attr("y", function(d,i){
          return d.years[17].population/100000;
        })
      }

    function showByGDPAndPopulation() {
        svg.selectAll("circle")
        .transition().duration(1500)
        .attr("cx", function(d,i){
          return d.years[17].population/100000;
        })
        .attr("cy", function(d,i){
          return d.years[17].gdp/100000000;
        })

        svg.selectAll("text")
        .transition().duration(1500)
        .attr("x", function(d,i){
          return d.years[17].population/100000 + 10;
        })
        .attr("y", function(d,i){
          return d.years[17].gdp/100000000;
        })
      }

    function showByLifeExpectancyAndGDP() {
      svg.selectAll("circle")
        .transition().duration(1500)
      .attr("cx", function(d) {
          return d.years[17].gdp/100000000;
        })
      .attr("cy", function(d,i){
        return d.years[17].life_expectancy*10 - 500;
      })

      svg.selectAll("text")
        .transition().duration(1500)
      .attr("x", function(d) {
          return d.years[17].gdp/100000000 + 10;
        })
      .attr("y", function(d,i){
        return d.years[17].life_expectancy*10 - 500;
      })
    }

    function showByLatAndLong() {
      svg.selectAll("circle")
        .transition().duration(1500)
      .attr("cx", function(d) {
          return d.longitude + 180;
        })
      .attr("cy", function(d,i){
          return d.latitude + 180;
        })

      svg.selectAll("text")
        .transition().duration(1500)
      .attr("x", function(d) {
          return d.longitude + 180 + 10;
        })
      .attr("y", function(d,i){
          return d.latitude + 180;
        })
    }

    function singlePoint() {
      svg.selectAll("circle")
        .transition().duration(1500)
      .attr("cx", function(d) {
          return width/2;
          // return 0;
        })
      .attr("cy", function(d,i){
          return height/10;
          // return 0 + 1500;
        })

      svg.selectAll("text")
        .transition().duration(1500)
      .attr("x", function(d) {
          return width/2 + 10;
        })
      .attr("y", function(d,i){
          return height/10;
        })
    }

    // a circular layout 
    function circular_layout() {

        var r = Math.min(height/1.5, width/1.5);

        var arc = d3.svg.arc()
                .outerRadius(r);

        var pie = d3.layout.pie()
                .sort(function(a, b) { return a.cat - b.cat;}) // Sorting by categories
                .value(function(d, i) { 
                  // it's fun to experiment with this here: return i for different spacing in each, and return 1 for even spacing
                  return 1;  // We want an equal pie share/slice for each point
                }); 

        // try using data.nodes, or just data
        placeholder = pie(data).map(function(d, i) {
          // Needed to caclulate the centroid
          d.innerRadius = 0;
          d.outerRadius = r;

          // Building the data object we are going to return
          d.data.x = arc.centroid(d)[0]+width/2;
          // ohhhhhh so I suppose that +width/2 is the x coordinate of the center of the circle
          d.data.y = arc.centroid(d)[1]+height/5;

        svg.selectAll("circle")
        // you can mess around with the duration if you want to; it's quite fun. My personal favorites are 900 and 2500 for the circle movement transitions
        .transition().duration(2000)
        .attr("cx", function(d) { return d.x; })
        .attr("cy", function(d) { return d.y; });

        svg.selectAll("text")
        .transition().duration(1000)
        .attr("x", function(d) { return d.x; })
        .attr("y", function(d) { return d.y; });  
        })
      }

    function mini_Circles() {

        var r = Math.min(height/3.5, width/3.5);

        var arc = d3.svg.arc()
                .outerRadius(r);

        var pie = d3.layout.pie()
                .sort(function(a, b) { return a.cat - b.cat;}) // Sorting by categories
                .value(function(d, i) { 
                  return 1;  // We want an equal pie share/slice for each point
                });

        var AsiaArray = [];
        var AfricaArray = [];
        var AmericasArray = [];
        var EuropeArray = [];
        var OceaniaArray = [];

        data.forEach(function(o, i) {

          if (o.continent == "Asia") {   
            AsiaArray.push(data[i]);
          }
          if (o.continent == "Africa") {   
            AfricaArray.push(data[i]);
          }
          if (o.continent == "Americas") {   
            AmericasArray.push(data[i]);
          }
          if (o.continent == "Europe") {   
            EuropeArray.push(data[i]);
          }
          if (o.continent == "Oceania") {   
            OceaniaArray.push(data[i]);
          }
        });   

        makeSmallCircles(AsiaArray);
        makeSmallCircles(AmericasArray);
        makeSmallCircles(AfricaArray);
        makeSmallCircles(EuropeArray);
        makeSmallCircles(OceaniaArray);

        function makeSmallCircles(continentArray) {
          // try using data.nodes, or just data
          placeholder = pie(continentArray).map(function(d, i) {
              // Needed to caclulate the centroid
              d.innerRadius = 0;
              d.outerRadius = r;

            if (continentArray[0].continent == "Asia") {
              d.data.x = arc.centroid(d)[0]+width/2 - 150;
              d.data.y = arc.centroid(d)[1]+250;
            }

            else if (continentArray[0].continent == "Africa") {
              d.data.x = arc.centroid(d)[0]+width/2 - 250;
              d.data.y = arc.centroid(d)[1]+150;
            }

            else if (continentArray[0].continent == "Americas") {
              d.data.x = arc.centroid(d)[0]+width/2 + 150;
              d.data.y = arc.centroid(d)[1]+250;
            }

            else if (continentArray[0].continent == "Europe") {
              d.data.x = arc.centroid(d)[0]+width/2 + 250;
              d.data.y = arc.centroid(d)[1]+150;
            }

            else if (continentArray[0].continent == "Oceania") {
              d.data.x = arc.centroid(d)[0]+width/2;
              d.data.y = arc.centroid(d)[1]+150;
            }

            svg.selectAll("circle")

            .transition().duration(2000)
            .attr("cx", function(d) { return d.x; })
            .attr("cy", function(d) { return d.y; });

            svg.selectAll("text")
            .transition().duration(1000)
            .attr("x", function(d) { return d.x; })
            .attr("y", function(d) { return d.y; });  
            });
          }

        }

    // responding to selections in the radio buttons
    d3.select("input[value=\"circularLayout\"]").on("click", circular_layout);

    d3.select("input[value=\"miniCircles\"]").on("click", mini_Circles);

    d3.select("input[value=\"default\"]").on("click", showByDefault);

    d3.select("input[value=\"population\"]").on("click", showByPopulation);

    d3.select("input[value=\"gdp\"]").on("click", showByGDP);

    d3.select("input[value=\"life_expectancy\"]").on("click", showByLifeExpectancy);
    
    d3.select("input[value=\"populationGDP\"]").on("click", showByPopulationAndGDP);

    d3.select("input[value=\"GDPpouplation\"]").on("click", showByGDPAndPopulation);

    d3.select("input[value=\"life_expectancyGDP\"]").on("click", showByLifeExpectancyAndGDP);

    d3.select("input[value=\"latlong\"]").on("click", showByLatAndLong);

    d3.select("input[value=\"singlePoint\"]").on("click", singlePoint);

    });

  </script>
</body>
</html>
